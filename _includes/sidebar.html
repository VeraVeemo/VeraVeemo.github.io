{% if page.author_profile or layout.author_profile or page.sidebar %}
  <div class="sidebar sticky">
    {% if page.author_profile or layout.author_profile %}
      {% include author-profile.html %}
    {% endif %}

    <!-- Discord Status -->
    <script>
      const socket = new WebSocket("wss://api.lanyard.rest/socket");

      const userId = "333585549837336577"; // Your Discord ID
      const statusMap = {
        online: "Online",
        idle: "Idle",
        dnd: "Do Not Disturb",
        offline: "Offline"
      };

      function updateStatus(data) {
        const presence = data.discord_status;
        const activities = data.activities;

        let display = `Discord: ${statusMap[presence] || "Unknown"}`;

        const game = activities.find(a => a.type === 0);
        const spotify = activities.find(a => a.type === 2);
        const customStatus = activities.find(a => a.type === 4);

        if (spotify && spotify.details) {
          display += `<br>ðŸŽ§ Listening to <strong>${spotify.details}</strong>`;
        } else if (game && game.name) {
          display += `<br>ðŸŽ® Playing <strong>${game.name}</strong>`;
        } else if (customStatus && customStatus.state) {
          display += `<br>ðŸ’¬ ${customStatus.state}`;
        }

        document.getElementById("discord-status").innerHTML = display;
      }

      socket.addEventListener("open", () => {
        socket.send(JSON.stringify({
          op: 2,
          d: {
            subscribe_to_ids: [userId]
          }
        }));
      });

      socket.addEventListener("message", event => {
        const payload = JSON.parse(event.data);
        if (payload.t === "INIT_STATE" || payload.t === "PRESENCE_UPDATE") {
          updateStatus(payload.d);
        }
      });
    </script>
  </div>
{% endif %}
